<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Details</title>
  <!-- --- Include html2canvas Library --- -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* ----- Global ----- */
    * {
      box-sizing: border-box;
    }
    html,
    body {
      height: 100%;
      margin: 0;
    }
    body {
      padding-block: 5rem;
      font-family: "Raleway", sans-serif;
    }
    h3 {
      font-size: 0.7em;
      letter-spacing: 1.2px;
      color: #a6a6a6;
    }
    img {
      max-width: 100%;
      filter: drop-shadow(1px 1px 3px #a6a6a6);
    }
    button.normal-btn{
      padding-inline: 30px;
      height: 3rem;
      background-color: #01e37f;
      color: white;
      border: none;
      border-radius: 8px;

      &>*{
        text-decoration: none;
        color: white;
      }
      font-size: larger;
      font-weight: bolder;
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
    /* ----- Product Section ----- */
    .product {
      margin-inline: auto;
      display: flex;
      flex-direction: row;
      padding: 2rem;
      width: 100%;
      max-width: 750px;
      background-color: white;
      position: relative;
    }
    /* ----- Photo Section ----- */
    .product__photo {
      position: relative;
      margin-right: 2rem;
    }
    .photo-container {
      display: flex;
      flex-direction: column;
    }
    .photo-main {
      display: flex;
      flex-direction: column;
    }
    .photo-main img {
      box-shadow: 4px 4px 25px -2px rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      height: 400px ;
      width: auto;
      aspect-ratio: 1/1;
      object-fit: cover ;
    }
    .photo-album {
      height: fit-content;
      padding: 0.7em 1em;
      border-radius: 0 0 6px 6px;
      background-color: #fff;
    }
    .photo-album ul {
      display: flex;
      justify-content: space-around;
      padding: 0;
      list-style: none;
    }
    .photo-album li {
      width: 75px;
      height: 75px;
      border-radius: 8px;
      overflow: hidden;
      margin: 0 2px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }
    /* ----- Informations Section ----- */
    .product__info {
      height: fit-content;
      padding: 0 2rem;
    }
    .title h1 {
      margin-bottom: 0em;
      color: #4c4c4c;
      font-size: 1.5em;
      font-weight: 900;
    }
    .title span {
      font-size: 0.7em;
      color: #a6a6a6;
    }
    .price {
      color: #ff3f40;
      font-size: 1.2em;
    }
    .price span {
      padding-left: 0.15em;
      font-size: 2em;
      margin: 0;
    }
    .variant {
      overflow: auto;
    }
    /* ----- Button Styles for Specifications ----- */
    .spec-option {
      display: inline-block;
      margin: 5px;
      padding: 10px 15px;
      background-color: #fff;
      color: #0172e3;
      border: 2px solid #0172e3;
      border-radius: 5px;
      cursor: pointer;
      font-size: medium;
      font-weight: bold;
    }
    .spec-option:hover {
      background-color: #b6daff;
    }
    .spec-option.active {
      background-color: #0172e3;
      color: #fff;
    }
    /* ----- Buy Button ----- */
    .buy--btn {
      border: none;
      color: #fff;
      box-shadow: 2px 2px 25px -7px #4c4c4c;
      cursor: pointer;
      border-radius: 7px;

      width:calc(10em + 6px);
      height:calc(3em + 6px);
      font-size:1.5em;
      font-weight:bold;

      position: relative;
      bottom: -1.1rem;
    }
    .buy--btn{
          animation:slidebg 2s linear infinite;
    }

    @keyframes slidebg {
      to {
        background-position:10em;
      }
    }
    /* ----- Footer ----- */
    footer {
      padding: 1em;
      text-align: center;
      color: #fff;
    }
    footer a {
      color: #4c4c4c;
    }
    footer a:hover {
      color: #ff3f40;
    }
    /* ----- Notification Popup ----- */
    .notification-popup {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fff;
      color: #000;
      padding: 15px 20px;
      border: 1px solid #aaa;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      z-index: 1000;
      font-family: Arial, sans-serif;
    }
    .notification-popup a {
      color: #ff3f40;
      text-decoration: none;
      font-weight: bold;
    }
    .notification-popup a:hover {
      text-decoration: underline;
    }
    a.beautylink {
      box-shadow: inset 0 0 0 0 #004d2c;
      color: #fff;
      margin: 0 -.25rem;
      padding: 0 .25rem;
      transition: color .3s ease-in-out, box-shadow .3s ease-in-out;
    }
    a.beautylink:hover {
      box-shadow: inset 100px 0 0 0 #004d2c;
      color: white;
    }

    @media only screen and (max-width: 1000px) {
      .product {
        flex-direction: column;
      }
      .product__info{
        padding-top: 2rem;
        padding-left: 0;
      }
      .buy--btn{
        bottom:-1rem
      }
    }
  </style>
</head>
<body id="bg">
  <section class="product">
    <div class="product__photo">
      <div class="photo-container">
        <div class="photo-main">
          <img id="mainImage" src="" alt="Product Image">
        </div>
        <div hidden class="photo-album">
          <ul id="photoAlbum"></ul>
        </div>
      </div>
    </div>
    <div class="product__info">
      <div class="title">
        <button class="normal-btn"><a href="index.html">&lt; Trở về</a></button>
        <h1 id="productName">Product Name</h1>
        <span id="productCode">COD: 00000</span>
      </div>
      <div class="price">
        <h3>Giá:</h3>
        <span id="productPrice"></span>
      </div>
      <div class="variant">
        <h3>Phân loại</h3>
        <div id="specifications"></div>
      </div>
      <button id="btn-bg" class="buy--btn">Đặt in và tư vấn</button>
    </div>
  </section>
  <footer>
    <p>&copy; 2025 by <a class="beautylink" target="_blank" href="https://github.com/nguyenanvi">@nguyenanvi</a></p>
  </footer>

  <script>
    let selectedSpecs = {}; // To store the user's selected specification indices

    // Helper: Get query parameter from URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // This function will update both the price and the displayed image(s)
    function updateDisplay(product, defaultImages, mainImage, photoAlbum) {
      const specKey = Object.values(selectedSpecs).join("_");

      // Update the price
      const productPriceElement = document.getElementById("productPrice");
      if (product.specification[specKey] !== undefined) {
        const price = product.specification[specKey];
        productPriceElement.textContent = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
         + "đ";
      } else {
        productPriceElement.textContent = product.base_price;
      }

      // Update the displayed image based on the specKey
      if (specKey && product.images[specKey] && product.images[specKey].length > 0) {
        mainImage.src = product.images[specKey][0];
        photoAlbum.innerHTML = product.images[specKey]
          .map(img => `<li><img src="${img}" alt="Product Image"></li>`)
          .join('');
      } else {
        // Fallback to using default images if no spec-specific image is available
        if (defaultImages.length > 0) {
          mainImage.src = defaultImages[0];
          photoAlbum.innerHTML = defaultImages
            .map(img => `<li><img src="${img}" alt="Product Image"></li>`)
            .join('');
        }
      }
    }

    // Fetch data and render the product details
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const id = getQueryParam('id') || 0;
        const product = data[id];

        if (!product) {
          document.body.innerHTML = '<h1>Product not found!</h1>';
          return;
        }

        // Update product text details
        document.getElementById('productName').textContent = product.name;
        document.getElementById('productCode').textContent = 'MS: ' + ('00000' + id).slice(-5);
        document.getElementById('productPrice').textContent = product.base_price;

        // Get references to image elements
        const mainImage = document.getElementById('mainImage');
        const photoAlbum = document.getElementById('photoAlbum');
        const defaultImages = (product.images.default || []);

        // Set default images initially
        if (defaultImages.length > 0) {
          mainImage.src = defaultImages[0];
          photoAlbum.innerHTML = defaultImages
            .map(img => `<li><img src="${img}" alt="Product Image"></li>`)
            .join('');
        }

        // Populate specifications – each specification will render buttons
        const specDiv = document.getElementById('specifications');
        for (const [specType, values] of Object.entries(product.specifications)) {
          const specSection = document.createElement('div');
          specSection.innerHTML = `<h4>${specType}</h4>`;
          values.forEach((val, idx) => {
            const btn = document.createElement('button');
            btn.textContent = val;
            btn.className = 'spec-option';
            btn.dataset.specType = specType;
            btn.dataset.specValue = idx;
            btn.addEventListener('click', function () {
              // Remove 'active' class for all buttons in this group, then mark this one active.
              document.querySelectorAll(`button[data-spec-type="${specType}"]`)
                .forEach(button => button.classList.remove('active'));
              btn.classList.add('active');
              selectedSpecs[specType] = idx;
              updateDisplay(product, defaultImages, mainImage, photoAlbum);
            });
            specSection.appendChild(btn);
          });
          specDiv.appendChild(specSection);
        }

        function createHex() {
          var hexCode1 = "";
          var hexValues1 = "0123456789abcdef";
          
          for ( var i = 0; i < 6; i++ ) {
            hexCode1 += hexValues1.charAt(Math.floor(Math.random() * hexValues1.length));
          }
          return hexCode1;
        }

        function generate() {
          
          var deg = Math.floor(Math.random() *360);
          var gradient = "linear-gradient(" + deg + "deg, " + "#" + createHex() + ", " + "#" + createHex() +")";
          document.getElementById("bg").style.background = gradient;
          document.getElementById("btn-bg").style.background = gradient;
          
        }

        // CONTACT ME button functionality (captures the product section as canvas)
        document.querySelector('.buy--btn').addEventListener('click', function (e) {
          e.preventDefault();
          html2canvas(document.querySelector('.product')).then(canvas => {
            const notification = document.createElement('div');
            notification.className = 'notification-popup';
            notification.innerHTML = 'Product captured, please <a href="https://zalo.me/0939963285" target="_blank">Contact me</a>';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 15000);
          });
        });
        document.onload = generate();
      })
      .catch(error => {
        console.error('Error loading product data:', error);
      });

  </script>
</body>
</html>
